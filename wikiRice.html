<!DOCTYPE html>
<html>
<body id="bod">

<iframe src="https://wikipedia.org/wiki/Special:Random" height = 1000 width = 1000>
    
    </iframe>

<p id="spank"></p>
<p id="wank"></p>

<script>
	//Create a new object to interact with the server
	var xhr = new XMLHttpRequest();

	//This extracts text, is a WIP... currently grabs the first-ish 1200 chars in plain text. Not sure how to grab later
	var url = "https://en.wikipedia.org/w/api.php?origin=*&action=query&format=json&prop=extracts&titles=Animal&formatversion=2&excharacters=1200&exlimit=50&explaintext=1"

	// Provide 3 arguments (GET/POST, The URL, Async True/False)
	xhr.open('GET', url, true);

	// Once request has loaded...
	xhr.onload = function() {
		// Parse the request into JSON
		var data = JSON.parse(this.response);

					// Log the data object
		console.log(data);

		// Log the page objects
		console.log(data.query.pages[0].extract)

		// Loop through the data object
		// Pulling out the titles of each page
		for (var i in data.query.pages) {
			console.log(data.query.pages[i].title);
		}

		var content = data.query.pages[0].extract;

		processContent(content);

	}
	// Send request to the server asynchronously
	xhr.send();


	function getEnds(spaced){
	
		let ends = []

		for (var i = 0; i < spaced.length; i++) {
			item = spaced[i]
			if (item.charAt(item.length-1) == "."){
				if (item.length > 3 || item.charAt(0) == item.charAt(0).toLowerCase() ){
					ends[ends.length] = i
				}
			}
		}
		return ends

	}

	function processContent(content){
		text = new String(content)
		var spaced = text.split(" ")
		for (var i = 0; i < spaced.length; i++){
			if (spaced[i].indexOf("\n") > -1 ){
				// BREAK STRING into two parts
				console.log("escape char found")
			}
		}
		var ends = getEnds(spaced)
		var data = generateWikiBlank(spaced,ends)
		document.getElementById("spank").innerHTML = data[0];
		document.getElementById("spank").name = data[1]

	}

	function getSentenceByIndex(spaced, ends, index){


		var start = 0
		if (index > 0){
			start = ends[index-1]+1
		} else {
			start = 0 
		}
		

		let passage = spaced[start]
		for (var i = start+1; i <= ends[index]; i++){
			passage = passage + " " + spaced[i]
		}
		document.getElementById("wank").innerHTML = passage;
		return passage
	} 

	function possibleBlank(item){
		if ((item.indexOf("ing") == item.length - 3 && item.length > 3)|| (item.indexOf("ed") == item.length-2 && item.length > 2)){
			if (item.charAt(0) == item.charAt(0).toLowerCase()){
				var flag = true
				for (var i = 0; i < item.length; i++){
					if (item.charAt(i).toLowerCase() == item.charAt(i).toUpperCase()){
					 	flag = false
					}
				}
				if (flag){
					console.log(item)
					return true 
				}
				
			}
		}

		//NEEDS TO TRIM PUNCTUATION\
		return false
	}

	function getPossibleBlanks (spaced, ends) {

		var possibleBlanks = []

		for (var k = 0; k < spaced.length; k++) {
			if (possibleBlank(spaced[k])) {
				possibleBlanks[possibleBlanks.length] = k
			}
		}

		return possibleBlanks // The index in spaced
	}

	function chooseBlank(spaced, ends) {
		var candidates = getPossibleBlanks(spaced, ends)
		var rngNum = Math.floor(Math.random()*candidates.length)

		//
		return candidates[rngNum]
	}


	function generateWikiBlank(spaced, ends){
		var blankId = chooseBlank(spaced, ends)
		var answer = spaced[blankId]
		console.log(answer)
		var question = ""
		var passage = ""
		
		var nextEnd = 0
		var flag = true
		for (var i = 0; i < ends.length; i++){
			if (ends[i] > blankId && flag){
				nextEnd = i // this is reset to ends[i] after lastEnd is set
				flag = false
			}
		}

		var lastEnd
		if (nextEnd == 0) {
			lastEnd = -1
		} else {
			lastEnd = ends[nextEnd-1]
		}
		nextEnd = ends[nextEnd]

		console.log(lastEnd)
		console.log(blankId)
		console.log(nextEnd)

		for (var i = lastEnd+1; i <= nextEnd; i++){
			if (i == blankId){
				question = question + " " + "____"
			} else {
				question = question + " " + spaced[i]
			}
			passage = passage + " " + spaced[i]

		}


		return [question, answer, passage]

	}



</script>

<form id = "myForm">
<input type="text" id="guess" name = "hue"/>
</form>

<script id="formHandle">

 	document.getElementById( "myForm" ).addEventListener( "submit", function ( event ) {
    	event.preventDefault();
    	JavaScript:check();
  	} );

  	function check(){
  		if (document.getElementById("guess").value == document.getElementById("spank").name){
			document.getElementById("wank").innerHTML = "You did it!";
  		}
  		console.log(document.getElementById("guess").value)
  		console.log(document.getElementById("spank").name)
		document.getElementById("guess").value = "";
	}

	function testForm(){
		var nameValue = document.getElementById("guess").value;
		document.getElementById("wank").innerHTML = nameValue;
		document.getElementById("guess").value = "";
	}

</script>

</body>
</html>
